/**********************************************************************/
/* This file is autogenerated - DO NOT EDIT! (change calc.rb instead) */
/**********************************************************************/

/*
 * Autogenerated code for Core1 firmware.
 *
 * Copyright (C) 2017-2018, 2020  John A. Tuffen, Simon Hickinbotham, wonkystuff
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 * Questions/queries can be directed to info@wonkystuff.net
 */

#include "wonkystuff.h"


void wonkystuff_init(){
    
    PLLCSR |= _BV(PLLE);                // Enable 64 MHz PLL
    delayMicroseconds(100);             // Stabilize
    while (!(PLLCSR & _BV(PLOCK)))
        ;                               // Wait for it...
    PLLCSR |= _BV(PCKE);                // Timer1 source = PLL

    ///////////////////////////////////////////////
    // Set up Timer/Counter1 for 250kHz PWM output
    TCCR1 = 0;                  // stop the timer
    TCNT1 = 0;                  // zero the timer
    GTCCR = _BV(PSR1);          // reset the prescaler
    TCCR1 = _BV(PWM1A) | _BV(COM1A1) | _BV(COM1A0) | _BV(CS10);
    OCR1C = 255;
    OCR1A = 128;                // start with 50% duty cycle on the PWM
    pinMode(PB1, OUTPUT);       // PWM output pin

    ///////////////////////////////////////////////
    // Set up Timer/Counter0 for sample-rate ISR
    TCCR0B = 0;                 // stop the timer (no clock source)
    TCNT0 = 0;                  // zero the timer
    TCCR0A = _BV(WGM01);        // CTC Mode
    TCCR0B = T1_PRESCALE;
    OCR0A  = T1_MATCH;          // calculated match value
    TIMSK |= _BV(OCIE0A);
}





const uint16_t octaveLookup[DACRANGE] PROGMEM = {
    0x5a1, // 0: 440.0 [5.632]
    0x5b5, // 1: 445.99723737865537 [5.708764638446789]
    0x5c9, // 2: 452.0762176122561 [5.786575585436878]
    0x5dd, // 3: 458.2380548628591 [5.865447102244596]
    0x5f2, // 4: 464.4838784786451 [5.945393644526658]
    0x606, // 5: 470.81483320090643 [6.026429864971602]
    0x61b, // 6: 477.23207937385604 [6.108570615985357]
    0x631, // 7: 483.73679315729765 [6.19183095241341]
    0x646, // 8: 490.33016674219266 [6.2762261343000665]
    0x65c, // 9: 497.01340856916676 [6.361771629685334]
    0x672, // 10: 503.7877435499938 [6.448483117439921]
    0x689, // 11: 510.65441329209943 [6.536376490138872]
    0x6a0, // 12: 517.6146763261237 [6.6254678569743835]
    0x6b7, // 13: 524.6698083365865 [6.715773546708307]
    0x6ce, // 14: 531.8211023956959 [6.807310110664908]
    0x6e6, // 15: 539.069869200344 [6.900094325764403]
    0x6fe, // 16: 546.4174373123329 [6.994143197597862]
    0x716, // 17: 553.8651534018753 [7.0894739635440045]
    0x72f, // 18: 561.4143824944125 [7.18610409592848]
    0x748, // 19: 569.0665082207994 [7.284051305226233]
    0x762, // 20: 576.8229330708964 [7.383333543307474]
    0x77b, // 21: 584.68507865062 [7.483969006727936]
    0x796, // 22: 592.6543859424961 [7.58597614006395]
    0x7b0, // 23: 600.7323155697652 [7.689373639292994]
    0x7cb, // 24: 608.920348064086 [7.794180455220301]
    0x7e6, // 25: 617.21998413689 [7.900415796952193]
    0x802, // 26: 625.6327449544328 [8.00809913541674]
    0x81e, // 27: 634.1601724165953 [8.11725020693242]
    0x83a, // 28: 642.8038294394847 [8.227889016825404]
    0x857, // 29: 651.5653002418876 [8.340035843096162]
    0x874, // 30: 660.4461906356272 [8.453711240136029]
    0x891, // 31: 669.4481283198784 [8.568936042494443]
    0x8af, // 32: 678.5727631794939 [8.685731368697523]
    0x8cd, // 33: 687.8217675873974 [8.804118625118686]
    0x8ec, // 34: 697.1968367110973 [8.924119509902045]
    0x90b, // 35: 706.6996888233792 [9.045756016939254]
    0x92b, // 36: 716.3320656172331 [9.169050439900584]
    0x94b, // 37: 726.0957325250718 [9.294025376320919]
    0x96b, // 38: 735.9924790423025 [9.420703731741472]
    0x98c, // 39: 746.0241190553063 [9.54910872390792]
    0x9ad, // 40: 756.1924911738903 [9.679263887025796]
    0x9cf, // 41: 766.4994590682688 [9.811193076073842]
    0x9f1, // 42: 776.94691181064 [9.944920471176193]
    0xa14, // 43: 787.5367642214164 [10.080470582034131]
    0xa37, // 44: 798.2709572201755 [10.217868252418247]
    0xa5b, // 45: 809.1514581813932 [10.357138664721832]
    0xa7f, // 46: 820.1802612950271 [10.498307344576347]
    0xaa4, // 47: 831.3593879320132 [10.641400165529769]
    0xac9, // 48: 842.6908870147448 [10.786443353788734]
    0xaee, // 49: 854.1768353926018 [10.933463493025302]
    0xb15, // 50: 865.8193382225974 [11.082487529249246]
    0xb3b, // 51: 877.6205293552136 [11.233542775746734]
    0xb62, // 52: 889.5825717254965 [11.386656918086354]
    0xb8a, // 53: 901.7076577494794 [11.541858019193336]
    0xbb2, // 54: 913.9980097260133 [11.69917452449297]
    0xbdb, // 55: 926.4558802440713 [11.858635267124113]
    0xc05, // 56: 939.0835525956048 [12.020269473223742]
    0xc2f, // 57: 951.8833411940294 [12.184106767283577]
    0xc59, // 58: 964.8575919984116 [12.350177177579669]
    0xc84, // 59: 978.0086829434395 [12.518511141676026]
    0xcb0, // 60: 991.3390243752528 [12.689139512003237]
    0xcdc, // 61: 1004.8510594932142 [12.862093561513142]
    0xd09, // 62: 1018.547264797701 [13.037404989410573]
    0xd37, // 63: 1032.4301505440008 [13.21510592696321]
    0xd65, // 64: 1046.5022612023945 [13.395228943390649]
    0xd93, // 65: 1060.766175924509 [13.577807051833716]
    0xdc3, // 66: 1075.2245090160268 [13.762873715405142]
    0xdf3, // 67: 1089.8799104158386 [13.950462853322733]
    0xe23, // 68: 1104.7350661817281 [14.14060884712612]
    0xe55, // 69: 1119.7926989826744 [14.333346546978232]
    0xe87, // 70: 1135.0555685978659 [14.528711278052683]
    0xeba, // 71: 1150.526472422516 [14.726738847008205]
    0xeed, // 72: 1166.2082459805724 [14.927465548551327]
    0xf21, // 73: 1182.103763444415 [15.130928172088513]
    0xf56, // 74: 1198.2159381616377 [15.337164008468962]
    0xf8b, // 75: 1214.5477231890095 [15.546210856819322]
    0xfc2, // 76: 1231.102111833714 [15.758107031471539]
    0xff9, // 77: 1247.8821382019653 [15.972891368985156]
    0x1030, // 78: 1264.8908777551044 [16.190603235265336]
    0x1069, // 79: 1282.1314478732704 [16.41128253277786]
    0x10a2, // 80: 1299.6070084267594 [16.63496970786252]
    0x10dc, // 81: 1317.3207623551673 [16.86170575814614]
    0x1117, // 82: 1335.275956254429 [17.091532240056694]
    0x1153, // 83: 1353.475880971858 [17.324491276439783]
    0x118f, // 84: 1371.9238722092964 [17.560625564278993]
    0x11cc, // 85: 1390.6233111344857 [17.799978382521417]
    0x120a, // 86: 1409.5776250007702 [18.04259360000986]
    0x1249, // 87: 1428.7902877752495 [18.288515683523194]
    0x1289, // 88: 1448.2648207754892 [18.53778970592626]
    0x12ca, // 89: 1468.0047933149126 [18.79046135443088]
    0x130b, // 90: 1488.0138233569887 [19.046576938969455]
    0x134e, // 91: 1508.2955781783348 [19.306183400682684]
    0x1391, // 92: 1528.8537750408614 [19.569328320523024]
    0x13d6, // 93: 1549.6921818730739 [19.836059927975345]
    0x141b, // 94: 1570.8146179606629 [20.106427109896483]
    0x1461, // 95: 1592.2249546465082 [20.380479419475304]
    0x14a8, // 96: 1613.9271160402213 [20.658267085314833]
    0x14f0, // 97: 1635.925079737362 [20.939841020638234]
    0x1539, // 98: 1658.2228775484543 [21.225252832620214]
    0x1583, // 99: 1680.824596237943 [21.514554831845672]
    0x15ce, // 100: 1703.7343782732191 [21.807800041897206]
    0x161a, // 101: 1726.956422583856 [22.105042209073357]
    0x1668, // 102: 1750.4949853311944 [22.406335812239288]
    0x16b6, // 103: 1774.354380688415 [22.71173607281171]
    0x1705, // 104: 1798.5389816312452 [23.02129896487994]
    0x1755, // 105: 1823.0532207394447 [23.33508122546489]
    0x17a7, // 106: 1847.9015910092096 [23.65314036491788]
    0x17f9, // 107: 1873.0886466766576 [23.97553467746122]
    0x184d, // 108: 1898.619004052531 [24.302323251872398]
    0x18a2, // 109: 1924.497342368279 [24.63356598231397]
    0x18f8, // 110: 1950.7284046336745 [24.969323579311034]
    0x194f, // 111: 1977.316998506115 [25.30965758087827]
    0x19a7, // 112: 2004.267997171777 [25.65463036379875]
    0x1a01, // 113: 2031.58634023878 [26.004305155056382]
    0x1a5b, // 114: 2059.2770346425204 [26.35874604342426]
    0x1ab7, // 115: 2087.345155563349 [26.71801799121087]
    0x1b15, // 116: 2115.7958473567573 [27.082186846166493]
    0x1b73, // 117: 2144.634324496239 [27.45131935355186]
    0x1bd3, // 118: 2173.865872529003 [27.825483168371235]
    0x1c34, // 119: 2203.4958490447166 [28.20474686777237]
    0x1c96, // 120: 2233.5296846574506 [28.58917996361537]
    0x1cfa, // 121: 2263.972884001005 [28.97885291521286]
    0x1d5f, // 122: 2294.831026737807 [29.37383714224393]
    0x1dc6, // 123: 2326.109768581557 [29.77420503784393]
    0x1e2e, // 124: 2357.814842333813 [30.180029981872806]
    0x1e97, // 125: 2389.952058934706 [30.59138635436424]
    0x1f02, // 126: 2422.527308527973 [31.00834954915806]
    0x1f6e, // 127: 2455.5465615405124 [31.430995987718557]
    0x1fdc, // 128: 2489.0158697766474 [31.859403133141086]
    0x204b, // 129: 2522.9413675273086 [32.29364950434955]
    0x20bb, // 130: 2557.3292726943328 [32.733814690487456]
    0x212e, // 131: 2592.1858879300867 [33.17997936550511]
    0x21a1, // 132: 2627.517601792626 [33.63222530294561]
    0x2217, // 133: 2663.330889916593 [34.09063539093239]
    0x228e, // 134: 2699.632316200082 [34.555293647361054]
    0x2306, // 135: 2736.428534007676 [35.02628523529825]
    0x2380, // 136: 2773.7262873898803 [35.50369647859047]
    0x23fc, // 137: 2811.5324123191835 [35.98761487768555]
    0x247a, // 138: 2849.85383794296 [36.47812912566989]
    0x24f9, // 139: 2888.6975878534513 [36.97532912452418]
    0x257a, // 140: 2928.070781375056 [37.47930600160072]
    0x25fd, // 141: 2967.9806348691723 [37.990152126325405]
    0x2682, // 142: 3008.434463056815 [38.50796112712723]
    0x2708, // 143: 3049.4396803592676 [39.03282790859863]
    0x2790, // 144: 3091.003802257007 [39.56484866888969]
    0x281a, // 145: 3133.134446667147 [40.104120917339486]
    0x28a6, // 146: 3175.839335339658 [40.65074349234762]
    0x2934, // 147: 3219.1262952726192 [41.204816579489524]
    0x29c4, // 148: 3263.0032601467583 [41.76644172987851]
    0x2a55, // 149: 3307.478271779546 [42.33572187877819]
    0x2ae9, // 150: 3352.5594815991067 [42.912761364468565]
    0x2b7f, // 151: 3398.255152138224 [43.49766594736926]
    0x2c17, // 152: 3444.5736585487043 [44.09054282942341]
    0x2cb1, // 153: 3491.523490136386 [44.69150067374574]
    0x2d4c, // 154: 3539.1132519170656 [45.30064962453844]
    0x2deb, // 155: 3587.3516661936374 [45.918101327278556]
    0x2e8b, // 156: 3636.247574154724 [46.54396894918047]
    0x2f2d, // 157: 3685.8099374951003 [47.178367199937284]
    0x2fd2, // 158: 3736.0478400582024 [47.82141235274499]
    0x3079, // 159: 3786.9704895010245 [48.47322226561312]
    0x3122, // 160: 3838.587218981707 [49.133916402965845]
    0x31cd, // 161: 3890.907488870129 [49.80361585753765]
    0x327b, // 162: 3943.940888481816 [50.48244337256724]
    0x332b, // 163: 3997.697137835475 [51.170523364294084]
    0x33de, // 164: 4052.186089434499 [51.86798194476159]
    0x3493, // 165: 4107.417730072735 [52.57494694493101]
    0x354a, // 166: 4163.4021826648805 [53.29154793811047]
    0x3604, // 167: 4220.14970810182 [54.01791626370329]
    0x36c1, // 168: 4277.67070713125 [54.754185051280004]
    0x3780, // 169: 4335.975722263947 [55.500489244978525]
    0x3841, // 170: 4395.075439706001 [56.25696562823681]
    0x3906, // 171: 4454.980691317398 [57.02375284886269]
    0x39cd, // 172: 4515.7024565973 [57.80099144444544]
    0x3a96, // 173: 4577.25186469637 [58.588823868113536]
    0x3b63, // 174: 4639.640196456546 [59.38739451464379]
    0x3c32, // 175: 4702.878886478593 [60.19684974692599]
    0x3d04, // 176: 4766.979525217862 [61.017337922788634]
    0x3dd9, // 177: 4831.953861108593 [61.84900942218999]
    0x3eb1, // 178: 4897.813802717181 [62.692016674779914]
    0x3f8b, // 179: 4964.571420924793 [63.546514187837346]
    0x4069, // 180: 5032.238951139734 [64.41265857458859]
    0x414a, // 181: 5100.828795539964 [65.29060858291153]
    0x422e, // 182: 5170.353525346176 [66.18052512443106]
    0x4315, // 183: 5240.825883125877 [67.08257130401122]
    0x43ff, // 184: 5312.258785128848 [67.99691244964926]
    0x44ec, // 185: 5384.66532365445 [68.92371614277695]
    0x45dc, // 186: 5458.0587694512 [69.86315224897535]
    0x46d0, // 187: 5532.4525741490415 [70.81539294910773]
    0x47c7, // 188: 5607.86037272478 [71.78061277087718]
    0x48c2, // 189: 5684.29598600111 [72.75898862081421]
    0x49c0, // 190: 5761.773423179715 [73.75069981670035]
    0x4ac1, // 191: 5840.306884408888 [74.75592812043377]
    0x4bc6, // 192: 5919.91076338615 [75.77485777134272]
    0x4cce, // 193: 6000.59964999634 [76.80767551995315]
    0x4dda, // 194: 6082.388332985669 [77.85457066221656]
    0x4eea, // 195: 6165.291802672211 [78.9157350742043]
    0x4ffd, // 196: 6249.325253693354 [79.99136324727493]
    0x5114, // 197: 6334.504087790684 [81.08165232372076]
    0x522f, // 198: 6420.843916632828 [82.1868021329002]
    0x534e, // 199: 6508.360564676787 [83.30701522786288]
    0x5471, // 200: 6597.070072068256 [84.44249692247368]
    0x5597, // 201: 6686.988697581474 [85.59345532904287]
    0x56c2, // 202: 6778.13292159916 [86.76010139646925]
    0x57f1, // 203: 6870.519449133044 [87.94264894890296]
    0x5924, // 204: 6964.165212885588 [89.14131472493553]
    0x5a5b, // 205: 7059.0873763534255 [90.35631841732385]
    0x5b96, // 206: 7155.30333697311 [91.58788271325581]
    0x5cd6, // 207: 7252.830729309729 [92.83623333516452]
    0x5e1a, // 208: 7351.687428288993 [94.10159908209911]
    0x5f62, // 209: 7451.89155247337 [95.38421187165913]
    0x60af, // 210: 7553.461467382868 [96.68430678250071]
    0x6200, // 211: 7656.415788861098 [98.00212209742206]
    0x6356, // 212: 7760.7733864872 [99.33789934703616]
    0x64b1, // 213: 7866.55338703428 [100.69188335403878]
    0x6610, // 214: 7973.775177974983 [102.06432227807979]
    0x6774, // 215: 8082.45841103486 [103.4554676612462]
    0x68dd, // 216: 8192.623005794145 [104.86557447416506]
    0x6a4b, // 217: 8304.289153338646 [106.29490116273467]
    0x6bbe, // 218: 8417.477319960384 [107.74370969549292]
    0x6d36, // 219: 8532.208250908681 [109.21226561163112]
    0x6eb3, // 220: 8648.502974192364 [110.70083806966227]
    0x7035, // 221: 8766.382804433817 [112.20969989675285]
    0x71bd, // 222: 8885.869346775526 [113.73912763872673]
    0x734a, // 223: 9006.984500839912 [115.28940161075087]
    0x74dc, // 224: 9129.750464743109 [116.86080594871179]
    0x7674, // 225: 9254.189739163457 [118.45362866129226]
    0x7811, // 226: 9380.325131465457 [120.06816168275785]
    0x79b4, // 227: 9508.179759879922 [121.704700926463]
    0x7b5d, // 228: 9637.777057741117 [123.3635463390863]
    0x7d0b, // 229: 9769.140777781644 [125.04500195560504]
    0x7ebf, // 230: 9902.294996485869 [126.74937595501912]
    0x807a, // 231: 10037.264118502679 [128.47698071683428]
    0x823a, // 232: 10174.072881118409 [130.22813287831565]
    0x8400, // 233: 10312.746358790697 [132.00315339252091]
    0x85cd, // 234: 10453.309967744177 [133.80236758712547]
    0x87a0, // 235: 10595.78947062878 [135.6261052240484]
    0x8979, // 236: 10740.210981241551 [137.47470055989186]
    0x8b59, // 237: 10886.60096931279 [139.34849240720374]
    0x8d3f, // 238: 11034.986265357493 [141.24782419657592]
    0x8f2c, // 239: 11185.394065592835 [143.1730440395883]
    0x911f, // 240: 11337.85193692275 [145.12450479261122]
    0x931a, // 241: 11492.387821990416 [147.10256412147734]
    0x951b, // 242: 11649.030044299609 [149.107584567035]
    0x9723, // 243: 11807.807313405865 [151.13993361159507]
    0x9933, // 244: 11968.748730178406 [153.1999837462836]
    0x9b49, // 245: 12131.883792133769 [155.28811253931224]
    0x9d67, // 246: 12297.24239884215 [157.40470270517952]
    0x9f8c, // 247: 12464.854857407425 [159.55014217481505]
    0xa1b9, // 248: 12634.751888021874 [161.72482416667998]
    0xa3ed, // 249: 12806.964629596603 [163.9291472588365]
    0xa629, // 250: 12981.524645468728 [166.1635154619997]
    0xa86d, // 251: 13158.46392918632 [168.42833829358491]
    0xaab9, // 252: 13337.814910372237 [170.72403085276463]
    0xad0d, // 253: 13519.610460667855 [173.05101389654854]
    0xaf68, // 254: 13703.883899757802 [175.40971391689988]
    0xb1cc, // 255: 13890.66900147685 [177.80056321890368]
//  0xb439, // 256: 14080.0 [180.224]
};
